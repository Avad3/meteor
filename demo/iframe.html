<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meteor iFrame Demo</title>
  <link rel="shortcut icon" href="./assets/icon.png" type="image/png">
  <script src="/baremux/index.js"></script>
  <script src="/meteor/meteor.bundle.js"></script>
</head>
<body>
  <script type="module">
    let connection = new BareMux.BareMuxConnection("/baremux/worker.js")
    await connection.setTransport("/epoxy/index.mjs", [{
          wisp: localStorage.getItem("wisp") ||
          `${location.protocol === "http:" ? "ws:" : "wss:"}//${location.host}/wisp/`,
      }])
    if ("serviceWorker" in navigator) {
      await navigator.serviceWorker
        .getRegistrations()
        .then(async (registrations) => {
          for await (const registration of registrations) {
            await registration.unregister()
          }

          await navigator.serviceWorker.register("/sw.js")
          self.$meteor.util.log(
            "Service worker registered successfully",
            "cornflowerblue"
          )
        })
    }
    const el = document.createElement("iframe")
    el.src = sessionStorage.getItem("site") || self.$meteor.config.codec.encode("https://google.com")
    document.body.appendChild(el)
    Object.assign(el.style, {
      width: "100%",
      height: "100%",
      border: "none",
      outline: "none",
      top: "0",
      bottom: "0",
      left: "0",
      right: "0",
      position: "fixed",
    });

    console.log(self.$meteor.config)
  </script>
</body>

</html>
